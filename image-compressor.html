<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Compressor - MultiTools</title>
    <meta name="description" content="Compress images online for free with advanced features. Batch processing, quality control, and resize options available.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --text-color: #1f2937;
            --background-color: #f8fafc;
            --card-background: #ffffff;
            --accent-color: #3b82f6;
            --success-color: #22c55e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        body {
            background: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .navbar {
            background-color: var(--card-background);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-color);
            margin-left: 2rem;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--primary-color);
        }

        main {
            margin-top: 64px;
            padding: 2rem;
            min-height: calc(100vh - 64px - 100px);
        }

        .hero {
            text-align: center;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            margin: -2rem -2rem 2rem -2rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero p {
            max-width: 600px;
            margin: 0 auto;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .drop-zone {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            margin-bottom: 2rem;
        }

        .drop-zone:hover {
            border-color: var(--primary-color);
            background: #f8fafc;
        }

        .drop-zone i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .settings-panel {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .setting-group {
            margin-bottom: 1.5rem;
        }

        .setting-group h3 {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            color: var(--text-color);
        }

        .setting-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #64748b;
        }

        input[type="range"], input[type="number"], select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        input[type="range"] {
            padding: 0;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .preview-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .preview-card h3 {
            padding: 1rem;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            margin: 0;
        }

        .preview-image {
            width: 100%;
            height: 200px;
            object-fit: contain;
            background: #f8fafc;
            padding: 1rem;
        }

        .image-info {
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            font-size: 0.9rem;
            color: #64748b;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn i {
            margin-right: 0.5rem;
        }

        .actions {
            text-align: center;
            margin-top: 2rem;
        }

        footer {
            background: white;
            padding: 2rem;
            text-align: center;
            border-top: 1px solid #e2e8f0;
        }

        footer p {
            color: #64748b;
            margin-bottom: 1rem;
        }

        footer a {
            color: var(--primary-color);
            text-decoration: none;
            margin: 0 0.75rem;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .preview-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="logo">MultiTools</a>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="background-remover.html">Background Remove</a>
            <a href="#contact">Contact</a>
        </div>
    </nav>

    <main>
        <div class="hero">
            <h1>Image Compressor</h1>
            <p>Compress your images with advanced controls. Maintain quality while reducing file size.</p>
        </div>

        <div class="container">
            <!-- File Upload Stats -->
            <div class="upload-stats" id="uploadStats" style="display: none; margin-bottom: 2rem; text-align: center;">
                <div class="stats-container" style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem;">
                        <div class="stat-item">
                            <i class="fas fa-images" style="color: var(--primary-color); font-size: 1.5rem;"></i>
                            <h4>Total Files</h4>
                            <span id="totalFiles">0</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-weight-hanging" style="color: var(--primary-color); font-size: 1.5rem;"></i>
                            <h4>Total Size</h4>
                            <span id="totalSize">0 MB</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-compress-arrows-alt" style="color: var(--primary-color); font-size: 1.5rem;"></i>
                            <h4>Potential Savings</h4>
                            <span id="potentialSavings">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="drop-zone" id="dropZone">
                <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>Drag & Drop Images Here</h3>
                <p>or click to select files</p>
                <div class="file-limits" style="margin-top: 1rem; font-size: 0.9rem; color: #64748b;">
                    <p>Supported: JPG, PNG, WebP, GIF</p>
                    <p>Max file size: 15 MB per image</p>
                </div>
            </div>

            <div class="settings-panel">
                <h2>Compression Settings</h2>
                <div class="settings-grid">
                    <div class="setting-group">
                        <h3>Quality</h3>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="flex: 1;">
                                <label>Compression Level: <span id="qualityValue">80%</span></label>
                                <input type="range" id="quality" min="1" max="100" value="80">
                                <div class="quality-labels" style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #64748b;">
                                    <span>Maximum Compression</span>
                                    <span>Best Quality</span>
                                </div>
                            </div>
                            <button id="previewCompressBtn" class="btn btn-secondary" style="white-space: nowrap;">
                                <i class="fas fa-eye"></i>
                                Preview Size
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="previewContainer" class="preview-grid"></div>

            <div class="actions">
                <button id="compressBtn" class="btn btn-primary" disabled>
                    <i class="fas fa-compress"></i>
                    Compress Images
                </button>
                <button id="resetBtn" class="btn btn-secondary" style="display: none; margin-left: 1rem;">
                    <i class="fas fa-redo"></i>
                    Reset
                </button>
            </div>

            <!-- Processing Modal -->
            <div id="processingModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                <div class="modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 2rem; border-radius: 12px; text-align: center; max-width: 400px; width: 90%;">
                    <div class="progress-container">
                        <div class="progress-circle" style="width: 80px; height: 80px; margin: 0 auto 1rem;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--primary-color);"></i>
                        </div>
                        <h3 id="processingStatus">Processing Images...</h3>
                        <p id="processingDetails" style="color: #64748b; margin-top: 0.5rem;">Please wait while we compress your images</p>
                        <div class="progress-bar" style="margin-top: 1rem; height: 4px; background: #e2e8f0; border-radius: 2px;">
                            <div id="progressIndicator" style="width: 0%; height: 100%; background: var(--primary-color); border-radius: 2px; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 MultiTools. All rights reserved.</p>
        <div>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/browser-image-compression/2.0.2/browser-image-compression.min.js"></script>
    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const qualitySlider = document.getElementById('quality');
        const qualityValue = document.getElementById('qualityValue');
        const compressBtn = document.getElementById('compressBtn');
        const previewCompressBtn = document.getElementById('previewCompressBtn');
        const resetBtn = document.getElementById('resetBtn');
        const previewContainer = document.getElementById('previewContainer');
        const processingModal = document.getElementById('processingModal');
        const progressIndicator = document.getElementById('progressIndicator');
        const processingStatus = document.getElementById('processingStatus');
        const processingDetails = document.getElementById('processingDetails');
        const uploadStats = document.getElementById('uploadStats');
        const totalFilesElement = document.getElementById('totalFiles');
        const totalSizeElement = document.getElementById('totalSize');
        const potentialSavingsElement = document.getElementById('potentialSavings');

        let selectedFiles = [];
        let totalOriginalSize = 0;

        // Update quality value display
        qualitySlider.addEventListener('input', () => {
            qualityValue.textContent = qualitySlider.value + '%';
        });

        // File size validation
        function validateFile(file) {
            const maxSize = 15 * 1024 * 1024; // 15MB
            const validTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];
            
            if (!validTypes.includes(file.type)) {
                throw new Error(`${file.name} is not a supported image format`);
            }
            
            if (file.size > maxSize) {
                throw new Error(`${file.name} exceeds the 15MB size limit`);
            }
            
            return true;
        }

        // Update upload statistics
        function updateUploadStats() {
            if (selectedFiles.length > 0) {
                uploadStats.style.display = 'block';
                totalFilesElement.textContent = selectedFiles.length;
                totalOriginalSize = selectedFiles.reduce((sum, file) => sum + file.size, 0);
                totalSizeElement.textContent = formatFileSize(totalOriginalSize);
            } else {
                uploadStats.style.display = 'none';
            }
        }

        function createPreviewCard(src, file, index) {
            const card = document.createElement('div');
            card.className = 'preview-card';
            
            const title = document.createElement('h3');
            title.textContent = file.name;
            
            const img = document.createElement('img');
            img.src = src;
            img.className = 'preview-image';
            
            const info = document.createElement('div');
            info.className = 'image-info';
            info.innerHTML = `
                <div style="margin-bottom: 0.5rem;">
                    <strong>Original Size:</strong> ${formatFileSize(file.size)}
                </div>
                <div class="compressed-info" style="display: none;"></div>
            `;
            
            card.appendChild(title);
            card.appendChild(img);
            card.appendChild(info);
            
            return card;
        }

        // Handle file selection
        function handleFiles(files) {
            const validFiles = [];
            const errors = [];
            
            Array.from(files).forEach(file => {
                try {
                    if (validateFile(file)) {
                        validFiles.push(file);
                    }
                } catch (error) {
                    errors.push(error.message);
                }
            });
            
            if (errors.length > 0) {
                alert('Some files were not added:\n' + errors.join('\n'));
            }
            
            // Append new files to existing ones instead of replacing
            selectedFiles = [...selectedFiles, ...validFiles];
            compressBtn.disabled = selectedFiles.length === 0;
            
            if (selectedFiles.length > 0) {
                dropZone.style.display = 'block';
                resetBtn.style.display = 'inline-flex';
                updateUploadStats();
            }
            
            // Create previews only for new files
            validFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = createPreviewCard(e.target.result, file, selectedFiles.length - validFiles.length + index);
                    previewContainer.appendChild(preview);
                };
                reader.readAsDataURL(file);
            });
        }

        function calculateReduction(originalSize, compressedSize) {
            const reduction = ((originalSize - compressedSize) / originalSize) * 100;
            return Math.max(0, Math.min(100, reduction)).toFixed(1); // Ensure between 0-100
        }

        // Preview compression button
        previewCompressBtn.addEventListener('click', async () => {
            if (selectedFiles.length === 0) return;

            previewCompressBtn.disabled = true;
            previewCompressBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Calculating...';
            
            let totalCompressedSize = 0;

            for (let i = 0; i < selectedFiles.length; i++) {
                const file = selectedFiles[i];
                const options = {
                    maxSizeMB: Math.ceil(file.size / (1024 * 1024)),
                    useWebWorker: true,
                    maxIteration: 10,
                    quality: parseFloat(qualitySlider.value) / 100,
                    alwaysKeepResolution: true,
                    initialQuality: parseFloat(qualitySlider.value) / 100,
                };

                try {
                    const compressedFile = await imageCompression(file, options);
                    totalCompressedSize += compressedFile.size;
                    
                    // Update preview card with compressed info
                    const cards = previewContainer.children;
                    if (cards[i]) {
                        const info = cards[i].querySelector('.compressed-info');
                        info.innerHTML = `
                            <div style="color: var(--accent-color);">
                                <strong>Compressed Size:</strong> ${formatFileSize(compressedFile.size)}
                            </div>
                        `;
                        info.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Error calculating compression:', error);
                }
            }

            // Update potential savings
            const totalReduction = calculateReduction(totalOriginalSize, totalCompressedSize);
            potentialSavingsElement.textContent = `${totalReduction}%`;

            previewCompressBtn.disabled = false;
            previewCompressBtn.innerHTML = '<i class="fas fa-eye"></i> Preview Size';
        });

        // Handle drag and drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-color');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.style.borderColor = '#cbd5e1';
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '#cbd5e1';
            handleFiles(e.dataTransfer.files);
        });

        dropZone.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', () => {
            handleFiles(fileInput.files);
        });

        compressBtn.addEventListener('click', async () => {
            processingModal.style.display = 'flex';
            compressBtn.disabled = true;
            
            const totalFiles = selectedFiles.length;
            let processedFiles = 0;

            try {
                // Process all files in parallel
                const compressionPromises = selectedFiles.map(async (file, i) => {
                    const options = {
                        maxSizeMB: Math.ceil(file.size / (1024 * 1024)),
                        useWebWorker: true,
                        maxIteration: 10,
                        quality: parseFloat(qualitySlider.value) / 100,
                        alwaysKeepResolution: true,
                        initialQuality: parseFloat(qualitySlider.value) / 100,
                    };

                    processingStatus.textContent = `Processing ${totalFiles} images...`;
                    processingDetails.textContent = `${processedFiles} of ${totalFiles} complete`;
                    
                    const compressedFile = await imageCompression(file, options);
                    processedFiles++;
                    progressIndicator.style.width = `${(processedFiles / totalFiles) * 100}%`;
                    
                    // Update preview card with compressed info
                    const cards = previewContainer.children;
                    if (cards[i]) {
                        const info = cards[i].querySelector('.compressed-info');
                        info.innerHTML = `
                            <div style="color: var(--success-color);">
                                <strong>Compressed Size:</strong> ${formatFileSize(compressedFile.size)}
                            </div>
                        `;
                        info.style.display = 'block';
                    }

                    // Prepare download
                    return {
                        file: compressedFile,
                        originalName: file.name
                    };
                });

                // Wait for all compressions to complete
                const results = await Promise.all(compressionPromises);
                
                // Download all compressed files
                results.forEach(result => {
                    const downloadLink = document.createElement('a');
                    downloadLink.href = URL.createObjectURL(result.file);
                    downloadLink.download = `compressed_${result.originalName}`;
                    downloadLink.click();
                    URL.revokeObjectURL(downloadLink.href);
                });

                processingStatus.textContent = 'All images compressed successfully!';
                processingDetails.textContent = `${totalFiles} of ${totalFiles} complete`;
                
                setTimeout(() => {
                    processingModal.style.display = 'none';
                    compressBtn.innerHTML = '<i class="fas fa-check"></i> Compression Complete';
                    compressBtn.style.background = 'var(--success-color)';
                }, 1000);

            } catch (error) {
                console.error('Error during compression:', error);
                processingStatus.textContent = 'Error during compression';
                processingDetails.textContent = 'Please try again';
            }
        });

        resetBtn.addEventListener('click', () => {
            fileInput.value = '';
            selectedFiles = [];
            previewContainer.innerHTML = '';
            dropZone.style.display = 'block';
            uploadStats.style.display = 'none';
            resetBtn.style.display = 'none';
            compressBtn.disabled = true;
            previewCompressBtn.disabled = false;
            compressBtn.innerHTML = '<i class="fas fa-compress"></i> Compress Images';
            previewCompressBtn.innerHTML = '<i class="fas fa-eye"></i> Preview Size';
            compressBtn.style.background = '';
            qualitySlider.value = 80;
            qualityValue.textContent = '80%';
            potentialSavingsElement.textContent = '-';
            processingModal.style.display = 'none';
            progressIndicator.style.width = '0%';
        });

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
